# Windows 작업 스케줄러 설정 가이드

Monitoring 시스템을 24시간 자동으로 실행하고, 중단 시 자동 재시작하도록 Windows 작업 스케줄러를 설정하는 방법입니다.

## 1. 작업 스케줄러 열기

1. `Win + R` 키를 눌러 실행 창 열기
2. `taskschd.msc` 입력 후 엔터
3. 작업 스케줄러가 실행됩니다

## 2. 새 작업 만들기

### 2-1. 기본 작업 생성

1. 오른쪽 패널에서 **"작업 만들기..."** 클릭
2. **일반** 탭에서:
   - 이름: `Monitoring System`
   - 설명: `서버 모니터링 시스템 자동 실행`
   - **"사용자의 로그온 여부에 관계없이 실행"** 선택
   - **"가장 높은 수준의 권한으로 실행"** 체크

### 2-2. 트리거 설정

1. **트리거** 탭 → **새로 만들기** 클릭
2. 다음과 같이 설정:
   - 작업 시작: **"시작할 때"** (컴퓨터 부팅 시 자동 실행)
   - 고급 설정:
     - ✅ **사용** 체크
     - 작업 반복 간격: **5분** (선택사항, 프로세스 감시용)
     - 기간: **무기한**

### 2-3. 동작 설정

1. **동작** 탭 → **새로 만들기** 클릭
2. 다음과 같이 설정:
   - 동작: **"프로그램 시작"**
   - 프로그램/스크립트: `powershell.exe`
   - 인수 추가:
     ```
     -ExecutionPolicy Bypass -File "C:\Programming\CascadeProjects\monitoring\scripts\prod.bat"
     ```
     (실제 프로젝트 경로로 수정)
   - 시작 위치: `C:\Programming\CascadeProjects\monitoring`

### 2-4. 조건 설정

1. **조건** 탭에서:
   - ❌ **"다음 AC 전원에서만 작업 시작"** 체크 해제
   - ❌ **"컴퓨터의 AC 전원이 DC 전원으로 전환되면 중지"** 체크 해제

### 2-5. 설정 탭

1. **설정** 탭에서:
   - ✅ **"요청 시 작업 실행 허용"** 체크
   - ✅ **"작업이 실패하면 다시 시작 간격"** 체크
     - 간격: **1분**
     - 재시도 횟수: **3회**
   - 작업이 이미 실행 중인 경우: **"새 인스턴스를 시작하지 않음"** 선택

## 3. 작업 저장 및 테스트

1. **확인** 버튼 클릭
2. Windows 계정 비밀번호 입력 (필요 시)
3. 작업 목록에서 `Monitoring System` 우클릭 → **"실행"** 클릭하여 테스트

## 4. 작업 확인

### 로그 확인
- 프로젝트 폴더의 `logs/` 디렉토리에서 로그 파일 확인
- 파일명: `monitoring_YYYYMMDD.log`

### 프로세스 확인
PowerShell에서 다음 명령어로 실행 여부 확인:
```powershell
Get-Process python | Where-Object { $_.CommandLine -like "*app.py*" }
```

### 웹 접속 확인
브라우저에서 `http://localhost:8080` 접속

## 5. 문제 해결

### 작업이 실행되지 않는 경우

1. **실행 정책 확인**
   ```powershell
   Get-ExecutionPolicy
   ```
   `Restricted`인 경우 다음 명령어로 변경:
   ```powershell
   Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
   ```

2. **Python PATH 확인**
   - 명령 프롬프트에서 `python --version` 실행
   - 오류 발생 시 Python을 PATH에 추가

3. **로그 확인**
   - `logs/monitoring_YYYYMMDD.log` 파일에서 오류 메시지 확인

### 작업이 중복 실행되는 경우

- 작업 스케줄러에서 해당 작업의 **설정** 탭 확인
- "작업이 이미 실행 중인 경우" → **"새 인스턴스를 시작하지 않음"** 선택

## 6. 추가 최적화

### 프로세스 감시 작업 추가 (선택사항)

Flask 앱이 예기치 않게 종료될 경우를 대비한 감시 스크립트:

1. 새 작업 생성: `Monitoring System - Watchdog`
2. 트리거: 5분마다 반복
3. 동작: 프로세스 확인 후 재시작 스크립트 실행

## 7. 보안 고려사항

- 작업 스케줄러는 관리자 권한으로 실행되므로 스크립트 경로 보안 유지
- `.env` 파일의 SECRET_KEY를 강력한 값으로 변경
- 방화벽에서 필요한 포트만 개방 (기본: 5000)

## 참고

- 작업 스케줄러 로그: `이벤트 뷰어` → `Windows 로그` → `응용 프로그램`
- 작업 기록: 작업 스케줄러 라이브러리에서 작업 선택 → 하단 **기록** 탭
